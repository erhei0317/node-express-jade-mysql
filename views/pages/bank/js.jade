doctype html
html(style='height: 100%')
  head
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width,initial-scale=1,user-scalable=0')
    title= title
    //-  引入公共文件
    include ../../includes/head
    link(rel='stylesheet', href='/css/bank.css')
  body.js-body(ontouchstart="",style='height: 100%;overflow:hidden;')
    .container(style='height: 100%;padding:0;')
      div.js-content(style='height: 100%')
        img#leftImg(src='/img/bank/js-left.png')
        div.js-content-right
          div.js-content-wrap(style='overflow-y:auto;')
            ul.js-ul-t
              li.clear-fix
                div.ul-t-ze-l 1,000.00
                div.ul-t-ze-r
                  span 活期储蓄
                  span#ll(contenteditable="true") 利率：0.30%
              li 币种：
                span 人民币
              li 开户日期：
                span#khrq(contenteditable="true") 2015/6/12&nbsp;&nbsp;&nbsp;&nbsp;
                span.pull-right 收支图
              li 龙卡通：
                span#lkt(contenteditable="true") 6217007200030671234&nbsp;&nbsp;&nbsp;&nbsp;
            ul.js-ul-c
              li.ul-c-t 交易日期：
                span#date(contenteditable="true") 2016/10/03 17:39:26
              li
                span#income  收入：
                span#sr.color-red(contenteditable="true") 10,000.00
              li
                span#expend 支出：
                span#zc.color-green(contenteditable="true") 1,000.00
              li 余额：
                span#ye(contenteditable="true") 10,000.00
              li 对方账户：
                span#dfzhin(contenteditable="true") 6222***7670&nbsp;&nbsp;张三
                span#dfzhout(contenteditable="true") 6222***7670&nbsp;&nbsp;李四
              li 摘要：
                span#zy(contenteditable="true") 补货&nbsp;&nbsp;&nbsp;&nbsp;
              li 交易地点/附言：
                span#jydd(contenteditable="true") 跨行转账&nbsp;&nbsp;&nbsp;&nbsp;
                //-第二条数据
            ul.js-ul-c
              li.ul-c-t 交易日期：
                span#date1(contenteditable="true") 2016/10/03 17:39:26
              li
                span#income1  收入：
                span#sr1.color-red(contenteditable="true") 10,000.00
              li
                span#expend1 支出：
                span#zc1.color-green(contenteditable="true") 1,000.00
              li 余额：
                span#ye1(contenteditable="true") 10,000.00
              li 对方账户：
                span#dfzhin1(contenteditable="true") 6222***7670&nbsp;&nbsp;张三
                span#dfzhout1(contenteditable="true") 6222***7670&nbsp;&nbsp;李四
              li 摘要：
                span#zy1(contenteditable="true") 补货&nbsp;&nbsp;&nbsp;&nbsp;
              li 交易地点/附言：
                span#jydd1(contenteditable="true") 跨行转账&nbsp;&nbsp;&nbsp;&nbsp;
  script.
    $(function () {
      //如果localStorage中存在数据则使用localStorage中的数据，否则将数据写入localStorage---start
      if (window.localStorage.jsll) {
        $('#ll').html(window.localStorage.jsll);
      } else {
        window.localStorage.jsll = $('#ll').html();
      }
      if (window.localStorage.jskhrq) {
        $('#khrq').html(window.localStorage.jskhrq);
      } else {
        window.localStorage.jskhrq = $('#khrq').html();
      }
      if (window.localStorage.jslkt) {
        $('#lkt').html(window.localStorage.jslkt);
      } else {
        window.localStorage.jslkt = $('#lkt').html();
      }
      //第一条数据
      if (window.localStorage.jssr) {
        $('#sr').html(window.localStorage.jssr);
      } else {
        window.localStorage.jssr = $('#sr').html();
      }
      if (window.localStorage.jszc) {
        $('#zc').html(window.localStorage.jszc);
      } else {
        window.localStorage.jszc = $('#zc').html();
      }
      if (window.localStorage.jsye) {
        $('#ye').html(window.localStorage.jsye);
      } else {
        window.localStorage.jsye = $('#ye').html();
      }
      if (window.localStorage.jsdfzhin) {
        $('#dfzhin').html(window.localStorage.jsdfzhin);
      } else {
        window.localStorage.jsdfzhin = $('#dfzhin').html();
      }
      if (window.localStorage.jsdfzhout) {
        $('#dfzhout').html(window.localStorage.jsdfzhout);
      } else {
        window.localStorage.jsdfzhout = $('#dfzhout').html();
      }
      if (window.localStorage.jszy) {
        $('#zy').html(window.localStorage.jszy);
      } else {
        window.localStorage.jszy = $('#zy').html();
      }
      if (window.localStorage.jsjydd) {
        $('#jydd').html(window.localStorage.jsjydd);
      } else {
        window.localStorage.jsjydd = $('#jydd').html();
      }
      //第二条数据
      if (window.localStorage.jssr1) {
        $('#sr1').html(window.localStorage.jssr1);
      } else {
        window.localStorage.jssr1 = $('#sr1').html();
      }
      if (window.localStorage.jszc1) {
        $('#zc1').html(window.localStorage.jszc1);
      } else {
        window.localStorage.jszc1 = $('#zc1').html();
      }
      if (window.localStorage.jsye1) {
        $('#ye1').html(window.localStorage.jsye1);
      } else {
        window.localStorage.jsye1 = $('#ye1').html();
      }
      if (window.localStorage.jsdfzhin1) {
        $('#dfzhin1').html(window.localStorage.jsdfzhin1);
      } else {
        window.localStorage.jsdfzhin1 = $('#dfzhin1').html();
      }
      if (window.localStorage.jsdfzhout1) {
        $('#dfzhout1').html(window.localStorage.jsdfzhout1);
      } else {
        window.localStorage.jsdfzhout1 = $('#dfzhout1').html();
      }
      if (window.localStorage.jszy1) {
        $('#zy1').html(window.localStorage.jszy1);
      } else {
        window.localStorage.jszy1 = $('#zy1').html();
      }
      if (window.localStorage.jsjydd1) {
        $('#jydd1').html(window.localStorage.jsjydd1);
      } else {
        window.localStorage.jsjydd1 = $('#jydd1').html();
      }
      //如果localStorage中存在数据则使用localStorage中的数据，否则将数据写入localStorage---end
      // 修改数据时，失焦后存入localStorage--start
      $('#ll').blur(function () {
        window.localStorage.jsll = $(this).html();
      });
      $('#khrq').blur(function () {
        window.localStorage.jskhrq = $(this).html();
      });
      $('#lkt').blur(function () {
        window.localStorage.jslkt = $(this).html();
      });
      //第一条数据
      $('#sr').blur(function () {
        var num = $(this).html();
        if(num.indexOf(',')>=0){
          num = formatNum(num);
          $(this).html(num);
          window.localStorage.jssr = $(this).html();
        }else {
          num = parseFloat(num);
          if (isNaN(num)) {
            alert('您的输入有误！')
          } else {
            num = formatNum(num);
            $(this).html(num);
            window.localStorage.jssr = $(this).html();
          }
        }
        var ye1 = beNum($('#ye1').html());
        var sr = beNum($('#sr').html());
        $('#ye').html(formatNum((parseFloat(ye1) + parseFloat(sr)).toFixed(2)));
        window.localStorage.jsye = $('#ye').html();
        $('.ul-t-ze-l').html($('#ye').html());
      });
      $('#zc').blur(function () {
        var num = $(this).html();
        if(num.indexOf(',')>=0){
          num = formatNum(num);
          $(this).html(num);
          window.localStorage.jszc = $(this).html();
        }else {
          num = parseFloat(num);
          if (isNaN(num)) {
            alert('您的输入有误！')
          } else {
            num = formatNum(num);
            $(this).html(num);
            window.localStorage.jszc = $(this).html();
          }
        }
        var ye1 = beNum($('#ye1').html());
        var zc = beNum($('#zc').html());
        $('#ye').html(formatNum((parseFloat(ye1) - parseFloat(zc)).toFixed(2)));
        window.localStorage.jsye = $('#ye').html();
        $('.ul-t-ze-l').html($('#ye').html());
      });
      $('#ye').blur(function () {
        var num = $(this).html();
        if(num.indexOf(',')>=0){
          num = formatNum(num);
          $(this).html(num);
          window.localStorage.jsye = $(this).html();
          $('.ul-t-ze-l').html($('#ye').html());
        }else {
          num = parseFloat(num);
          if (isNaN(num)) {
            alert('您的输入有误！')
          } else {
            num = formatNum(num);
            $(this).html(num);
            window.localStorage.jsye = $(this).html();
            $('.ul-t-ze-l').html($('#ye').html());
          }
        }
        var ye = beNum($('#ye').html());
        var zc = beNum($('#zc').html());
        var sr = beNum($('#sr').html());
        if ($("#sr").is(":hidden")) {
          $('#ye1').html(formatNum((parseFloat(ye) + parseFloat(zc)).toFixed(2)));
        }
        if ($("#zc").is(":hidden")) {
          $('#ye1').html(formatNum((parseFloat(ye) - parseFloat(sr)).toFixed(2)));
        }
        window.localStorage.jsye1 = $('#ye1').html();
      });
      $('#dfzhin').blur(function () {
        window.localStorage.jsdfzhin = $(this).html();
      });
      $('#dfzhout').blur(function () {
        window.localStorage.jsdfzhout = $(this).html();
      });
      $('#zy').blur(function () {
        window.localStorage.jszy = $(this).html();
      });
      $('#jydd').blur(function () {
        window.localStorage.jsjydd = $(this).html();
      });
      //第二条数据
      $('#sr1').blur(function () {
        var num = $(this).html();
        if(num.indexOf(',')>=0){
          num = formatNum(num);
          $(this).html(num);
          window.localStorage.jssr1 = $(this).html();
        }else {
          num = parseFloat(num);
          if (isNaN(num)) {
            alert('您的输入有误！')
          } else {
            num = formatNum(num);
            $(this).html(num);
            window.localStorage.jssr1 = $(this).html();
          }
        }
      });
      $('#zc1').blur(function () {
        var num = $(this).html();
        if(num.indexOf(',')>=0){
          num = formatNum(num);
          $(this).html(num);
          window.localStorage.jszc1 = $(this).html();
        }else {
          num = parseFloat(num);
          if (isNaN(num)) {
            alert('您的输入有误！')
          } else {
            num = formatNum(num);
            $(this).html(num);
            window.localStorage.jszc1 = $(this).html();
          }
        }
      });
      $('#ye1').blur(function () {
        var num = $(this).html();
        if(num.indexOf(',')>=0){
          num = formatNum(num);
          $(this).html(num);
          window.localStorage.jsye1 = $(this).html();
        }else {
          num = parseFloat(num);
          if (isNaN(num)) {
            alert('您的输入有误！')
          } else {
            num = formatNum(num);
            $(this).html(num);
            window.localStorage.jsye1 = $(this).html();
          }
        }
        var ye1 = beNum($('#ye1').html());
        var zc = beNum($('#zc').html());
        var sr = beNum($('#sr').html());
        if($("#sr").is(":hidden")){
          $('#ye').html(formatNum((parseFloat(ye1) - parseFloat(zc)).toFixed(2)));
        }
        if($("#zc").is(":hidden")){
          $('#ye').html(formatNum((parseFloat(ye1) + parseFloat(sr)).toFixed(2)));
        }
        window.localStorage.jsye = $('#ye').html();
        $('.ul-t-ze-l').html($('#ye').html());
      });
      $('#dfzhin1').blur(function () {
        window.localStorage.jsdfzhin1 = $(this).html();
      });
      $('#dfzhout1').blur(function () {
        window.localStorage.jsdfzhout1 = $(this).html();
      });
      $('#zy1').blur(function () {
        window.localStorage.jszy1 = $(this).html();
      });
      $('#jydd1').blur(function () {
        window.localStorage.jsjydd1 = $(this).html();
      });
      // 修改数据时，失焦后存入localStorage--end
      $('#date').html(format(new Date().getTime()));
      $('#date1').html(format(new Date().getTime() - (Math.random() * 2 + 1) * 3600 * 1000));  //比data早1-3个小时
      $('.js-content-right').css('marginLeft',parseInt($('#leftImg').width())+'px');
      $('.js-content-wrap').css('left',parseInt($('#leftImg').width())+2+'px');
      $('.ul-t-ze-l').html($('#ye').html());
      $('#expend').hide();
      $('#zc').hide();
      $('#dfzhout').hide();
      $('#expend1').hide();
      $('#zc1').hide();
      $('#dfzhout1').hide();
      $('#expend').click(function(){
        $(this).hide();
        $('#zc').hide();
        $('#dfzhout').hide();
        $('#income').show();
        $('#sr').show();
        $('#dfzhin').show();
        var ye1 = beNum($('#ye1').html());
        var sr = beNum($('#sr').html());
        $('#ye').html(formatNum((parseFloat(ye1) + parseFloat(sr)).toFixed(2)));
        window.localStorage.jsye = $('#ye').html();
        $('.ul-t-ze-l').html($('#ye').html());
      });
      $('#income').click(function () {
        $(this).hide();
        $('#sr').hide();
        $('#dfzhin').hide();
        $('#expend').show();
        $('#zc').show();
        $('#dfzhout').show();
        var ye1 = beNum($('#ye1').html());
        var zc = beNum($('#zc').html());
        $('#ye').html(formatNum((parseFloat(ye1) - parseFloat(zc)).toFixed(2)));
        window.localStorage.jsye = $('#ye').html();
        $('.ul-t-ze-l').html($('#ye').html());
      });
      $('#expend1').click(function(){
        $(this).hide();
        $('#zc1').hide();
        $('#dfzhout1').hide();
        $('#income1').show();
        $('#sr1').show();
        $('#dfzhin1').show();
      });
      $('#income1').click(function () {
        $(this).hide();
        $('#sr1').hide();
        $('#dfzhin1').hide();
        $('#expend1').show();
        $('#zc1').show();
        $('#dfzhout1').show();
      });
      function add0(m) {
        return m < 10 ? '0' + m : m
      }
      function format(shijianchuo) {
        //shijianchuo是整数，否则要parseInt转换
        shijianchuo = parseInt(shijianchuo)
        var time = new Date(shijianchuo);
        var y = time.getFullYear();
        var m = time.getMonth() + 1;
        var d = time.getDate();
        var h = time.getHours();
        var mm = time.getMinutes();
        var s = time.getSeconds();
        return y + '/' + add0(m) + '/' + add0(d) + ' ' + add0(h) + ':' + add0(mm) + ':' + add0(s);
      }
      function formatNum(str) {
        str += '';
        str = str.replace(/,/g, "");
        var newStr = "";
        var count = 0;
        if (str.indexOf(".") == -1) {
          for (var i = str.length - 1; i >= 0; i--) {
            if (count % 3 == 0 && count != 0) {
              newStr = str.charAt(i) + "," + newStr;
            } else {
              newStr = str.charAt(i) + newStr;
            }
            count++;
          }
          str = newStr + ".00"; //自动补小数点后两位
          console.log(str)
        }
        else {
          for (var i = str.indexOf(".") - 1; i >= 0; i--) {
            if (count % 3 == 0 && count != 0) {
              newStr = str.charAt(i) + "," + newStr;
            } else {
              newStr = str.charAt(i) + newStr; //逐个字符相接起来
            }
            count++;
          }
          str = newStr + (str + "00").substr((str + "00").indexOf("."), 3);
          console.log(str)
        }
        return str;
      }
      function beNum(str) {
        str += '';
        str = str.replace(/,/g, "");
        return str;
      }
      $('#ye').html(formatNum((parseFloat(beNum($('#ye1').html())) + parseFloat(beNum($('#sr').html()))).toFixed(2)));
      $('.ul-t-ze-l').html($('#ye').html());
    })
